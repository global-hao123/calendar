!function(e,a,n,t){n=n||window.require&&require("common:widget/ui/jquery/jquery.js");if(!n)return;var r=function(){},i=window.require&&require("common:widget/ui/helper/helper.js").replaceTpl||function(e,a,n){var t=n||/#\{([^}]*)\}/gm,r=function(e){return e.replace(/^\s+|\s+$/g,"")};return(e+"").replace(t,function(e,n){return e=a[r(n)]||""})},s=function(e,a){var t=this;t.$el=e;t.el=e[0];t.args=n.extend({now:new Date,selectorPrefix:"mod-calendar",weeks:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],tplMenu:'<option value="#{val}" #{selected}>#{name}</option>',tplWeek:"<li>#{name}</li>",tplDay:'<li #{className}><a href="#{url}" class="#{noLink}"><dl><dt>#{d}</dt><dd>#{info}</dd></dl></a></li>',footer:"",minDate:"2004/3/1",maxDate:"2024/3/1",isAbbrWeek:true,beginDay:1,switchLoop:false,onSwitch:r,onClick:r,onFilterDays:function(e){return e}},a);t.pre=t.args.selectorPrefix;t.args.weeks=t.args.weeks.splice(t.args.beginDay,t.args.weeks.length).concat(t.args.weeks.splice(0,t.args.beginDay+1));t.now=new Date(t.args.now);t.minDate=(+(t.minDate=t.args.minDate)?t.now.add(+t.minDate):new Date(t.minDate)).format();t.maxDate=(+(t.maxDate=t.args.maxDate)?t.now.add(+t.maxDate):new Date(t.maxDate)).format();t.now=t.now.format();t.state={};t.init()},o=s.prototype;o.init=function(){var e=this,a=e.$el,t=e.render;n("year|month|weeks|days|prev|next|ft".split("|")).map(function(n,t){e["$"+t]=a.find("."+e.pre+"_"+t)});e.render(e.$year,e.args.tplMenu,new Array(e.maxDate.y-e.minDate.y+1),function(a,n){var t=n+e.minDate.y,r=t;if(e.args.fixYear)r=e.args.fixYear(t);return{val:t,name:r,selected:t===e.now.y?'selected="selected"':""}});e.render(e.$weeks,e.args.tplWeek,e.args.weeks,function(a,n){return{name:e.args.isAbbrWeek?a.slice(0,3).toUpperCase():a}});e.$ft.html(e.args.footer);e.renderMonths(e.now.y,e.now.M);e.renderDays(e.now.M,e.now.y);e.fixBtnStatus(e.now.y,e.now.M);e.bindEvents()};o.renderMonths=function(e){var a=this,n=12;if(e===a.maxDate.y)n=a.maxDate.M;if(e===a.minDate.y)n=n-a.minDate.M+1;a.render(a.$month,a.args.tplMenu,new Array(n),function(n,t){t=t+(e===a.minDate.y?a.minDate.M:1);return{val:t,name:a.args.fixMonth?a.args.fixMonth(t):t,selected:t===a.now.M?'selected="selected"':""}})};o.filterDays=function(e,a,n,t,r,i){var s=this;return s.args.onFilterDays.call(s,{className:t,d:n,y:e,M:a,info:r,url:i||"#"})};o.renderDays=function(e,a,n){var t=this;t.render(t.$days,t.args.tplDay,new Array(7*6),function(n,r,i){var s=new Date(a,e-1,1).format().w-1-t.args.beginDay,o=Date.days(e,a),l=e;if(s<-1)s=s+7;r=r-s;i="";n="";if(r<1){l=e-1;r=r+(!l?Date.days(12,a-1):Date.days(l,a));n="class="+t.pre+"-holder"}else if(r>o){r=r-o;l=e+1;n="class="+t.pre+"-holder"}else if(a===t.now.y&&l===t.now.M&&r===t.now.d){n="class="+t.pre+"-today"}if(new Date(t.minDate.y,t.minDate.M-1,t.minDate.d).diff(new Date(a,l-1,r-1)).d<0||new Date(t.maxDate.y,t.maxDate.M-1,t.maxDate.d).diff(new Date(a,l-1,r+1)).d>0)n="class="+t.pre+"-holder";return t.filterDays(a,l,r,n,i)})};o.render=function(e,a,t,r){t=n.isArray(t)?t:[t];var s=[];n.map(t,function(e,n){s.push(i(a,r?r(e,n):t))});e.html(s.join(""))};o.fixBtnStatus=function(e,a){var t=this,r=t.pre+"-disable";if(t.args.switchLoop)return;n(t.$next).removeClass(r);n(t.$prev).removeClass(r);e=e||+t.$year.val();a=a||+t.$month.val();a===1||e===t.minDate.y&&a===t.minDate.M&&t.$prev.addClass(r);a===12||e===t.maxDate.y&&a===t.maxDate.M&&t.$next.addClass(r)};o.bindEvents=function(){var e=this,a=function(a){e.fixBtnStatus();e.renderDays(+e.$month.val(),+e.$year.val());e.args.onSwitch.call(e,{y:+e.$year.val(),M:+e.$month.val()},e.$year,e.$month)};e.$year.change(function(n){var t=+e.$month.val();e.renderMonths(+e.$year.val());e.$month.val(t);a(n)});e.$month.change(a);e.$prev.click(function(t){t.preventDefault();if(n(this).hasClass(e.pre+"-disable"))return;var r=+e.$month.val(),i=+e.$year.val();i===e.maxDate.y&&r===1&&e.renderMonths(i-1);e.args.switchLoop&&i===e.minDate.y&&r===e.minDate.M&&e.renderMonths(e.maxDate.y);if(i===e.minDate.y&&r===e.minDate.M){if(e.args.switchLoop){e.$month.val(e.maxDate.M);e.$year.val(e.maxDate.y)}}else{if(r===1){e.$month.val(12);e.$year.val(i-1)}else{e.$month.val(r-1)}}a()});e.$next.click(function(t){t.preventDefault();if(n(this).hasClass(e.pre+"-disable"))return;var r=+e.$month.val(),i=+e.$year.val();i===e.minDate.y&&r===e.minDate.M&&e.renderMonths(i-1);e.args.switchLoop&&i===e.maxDate.y&&r===e.maxDate.M&&e.renderMonths(e.minDate.y);if(i===e.maxDate.y&&r===e.maxDate.M){if(e.args.switchLoop){e.$month.val(1);e.$year.val(e.minDate.y)}}else{if(r===12){e.$month.val(1);e.$year.val(i+1)}else{e.$month.val(r+1)}}a()});e.$days.on("click","li",function(a){!n(this).hasClass("mod-calendar-holder")&&e.args.onClick.call(this,e.$year.val(),e.$month.val(),n(this).text())})};n.fn.extend({calendar:function(e){return new s(this,e)}})}(window,document,window.jQuery);